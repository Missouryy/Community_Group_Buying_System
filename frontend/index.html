<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ç¤¾åŒºå›¢è´­ - é¦–é¡µ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/apple-theme.css" rel="stylesheet">
    <link href="/styles.css" rel="stylesheet">
</head>
<body>
    <!-- å¯¼èˆªå°†ç”± nav.js åŠ¨æ€ç”Ÿæˆ -->

    <main class="container py-4">
        <!-- ç¤¾åŒºå›¢è´­æ¨ªå¹… -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-deal lift">
                    <div class="card-body text-center">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h2 class="mb-2">ğŸ˜ï¸ ç¤¾åŒºå›¢è´­ï¼Œé‚»é‡Œå…±äº«</h2>
                                <p class="text-muted mb-0">æ–°é²œé£Ÿæç›´ä¾›ï¼Œå›¢è´­ä»·æ ¼æ›´ä¼˜æƒ ï¼Œé‚»é‡Œä¸€èµ·çœæ›´å¤š</p>
                            </div>
                            <div class="col-md-4">
                                <div class="row g-2 text-center">
                                    <div class="col-4">
                                        <div class="fw-bold text-success fs-5" id="total-active-groups">0</div>
                                        <div class="text-muted small">æ´»è·ƒæ‹¼å•</div>
                                    </div>
                                    <div class="col-4">
                                        <div class="fw-bold text-primary fs-5" id="total-participants">0</div>
                                        <div class="text-muted small">å‚å›¢äººæ•°</div>
                                    </div>
                                    <div class="col-4">
                                        <div class="fw-bold text-warning fs-5" id="total-savings">Â¥0</div>
                                        <div class="text-muted small">å·²çœé‡‘é¢</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¿«æ·å…¥å£ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex gap-3 flex-wrap">
                    <button class="btn btn-outline-primary" onclick="filterGroupBuys('food')">
                        ğŸ¥¬ ç”Ÿé²œè”¬èœ
                    </button>
                    <button class="btn btn-outline-primary" onclick="filterGroupBuys('fruit')">
                        ğŸ æ–°é²œæ°´æœ
                    </button>
                    <button class="btn btn-outline-primary" onclick="filterGroupBuys('meat')">
                        ğŸ¥© è‚‰ç¦½è›‹ç±»
                    </button>
                    <button class="btn btn-outline-primary" onclick="filterGroupBuys('daily')">
                        ğŸ§´ æ—¥ç”¨ç™¾è´§
                    </button>
                    <button class="btn btn-outline-secondary" onclick="filterGroupBuys('all')">
                        ğŸ“‹ å…¨éƒ¨æ‹¼å•
                    </button>
                </div>
            </div>
        </div>

        <!-- æ‹¼å•åˆ—è¡¨ -->
        <div class="d-flex justify-content-between align-items-end mb-3">
            <div>
                <h3 class="m-0">ğŸ›’ æ­£åœ¨è¿›è¡Œçš„æ‹¼å•</h3>
                <div class="text-muted small">æ–°é²œç›´ä¾›ï¼Œæ‹¼å›¢ä¼˜æƒ </div>
            </div>
            <div class="d-flex align-items-center gap-2">
                <span class="text-muted small">æ’åºï¼š</span>
                <select class="form-select form-select-sm" style="width: auto;" onchange="sortGroupBuys(this.value)">
                    <option value="time">æœ€æ–°å‘å¸ƒ</option>
                    <option value="progress">å‚å›¢äººæ•°</option>
                    <option value="price">ä»·æ ¼ä½åˆ°é«˜</option>
                    <option value="ending">å³å°†ç»“æŸ</option>
                </select>
            </div>
        </div>
        <div id="groupbuy-list" class="row g-3"></div>

        <!-- æˆåŠŸæ¡ˆä¾‹å±•ç¤º -->
        <section class="section">
            <div class="card shadow-community">
                <div class="card-body">
                    <h5 class="card-title mb-3">ğŸ‰ æœ€è¿‘æˆåŠŸçš„æ‹¼å•</h5>
                    <div id="success-stories" class="row g-3">
                        <!-- æˆåŠŸæ¡ˆä¾‹å°†ç”±JavaScriptåŠ¨æ€å¡«å…… -->
                    </div>
                </div>
            </div>
        </section>

        <!-- ä¸ªæ€§åŒ–æ¨è -->
        <section class="section">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                    <h5 class="m-0">ğŸ’¡ ä¸ºä½ æ¨è</h5>
                    <div class="text-muted small">åŸºäºä½ çš„è´­ä¹°å†å²å’Œå…´è¶£</div>
                </div>
                <a href="#" class="btn btn-outline-secondary btn-sm" id="refresh-recos">
                    ğŸ”„ æ¢ä¸€æ‰¹
                </a>
            </div>
            <div id="reco-list" class="row g-3"></div>
        </section>

        <!-- ç¤¾åŒºå›¢é•¿æ¨è -->
        <section class="section">
            <div class="card shadow-deal">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <h5 class="card-title mb-1">ğŸ‘‘ ä¼˜ç§€å›¢é•¿</h5>
                            <div class="text-muted small">ä¸ºç¤¾åŒºæœåŠ¡çš„çƒ­å¿ƒé‚»å±…</div>
                        </div>
                        <a href="/profile.html" id="leader-cta-btn" class="btn btn-warning btn-sm">ç”³è¯·æˆä¸ºå›¢é•¿</a>
                    </div>
                    <div id="featured-leaders" class="row g-3">
                        <!-- å›¢é•¿æ¨èå°†ç”±JavaScriptåŠ¨æ€å¡«å…… -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Join Modal -->
    <div class="modal fade" id="joinModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">å‚ä¸æ‹¼å•</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="ratio-16x9 me-3" style="width:120px"><img id="join-image" alt=""></div>
                        <div>
                            <div id="join-name" class="fw-semibold"></div>
                            <div class="text-muted small">ä»·æ ¼ï¼š<span id="join-price">-</span></div>
                            <div class="text-muted small">å·²å‚ï¼š<span id="join-current">0</span> / ç›®æ ‡ï¼š<span id="join-target">0</span></div>
                        </div>
                    </div>
                    <div class="mb-2">
                        <label class="form-label">é€‰æ‹©æ•°é‡</label>
                        <input type="number" class="form-control" id="join-qty" value="1" min="1">
                        <input type="hidden" id="join-id">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <div class="btn-group">
                        <button class="btn btn-primary" id="join-submit">ç«‹å³å‚å›¢</button>
                        <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown">
                            <span class="visually-hidden">æ”¯ä»˜æ–¹å¼</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" data-payment="wechat">ğŸ’¬ å¾®ä¿¡æ”¯ä»˜</a></li>
                            <li><a class="dropdown-item" href="#" data-payment="alipay">ğŸ’° æ”¯ä»˜å®æ”¯ä»˜</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/nav.js"></script>
    <script src="/js/payment.js"></script>
    <script src="/js/websocket.js"></script>
    <script src="/js/user.js"></script>
    <script>
      // é¦–é¡µç‰¹å®šé€»è¾‘
      document.addEventListener('DOMContentLoaded', () => {
        // è¿æ¥WebSocketçŠ¶æ€åˆ°å¯¼èˆªç³»ç»Ÿ
        if (window.websocket && window.navSystem) {
          const originalShowStatus = window.websocket.showConnectionStatus || function() {};
          window.websocket.showConnectionStatus = function(status) {
            window.navSystem.setWebSocketStatus(status, status === 'connected' ? 'å®æ—¶è¿æ¥' : 'è¿æ¥æ–­å¼€');
          };
        }
        
        // Refresh recos handler
        document.getElementById('refresh-recos')?.addEventListener('click', (e) => {
          e.preventDefault();
          window.dispatchEvent(new CustomEvent('refresh-recommendations'));
        });

        // æ ¹æ®è§’è‰²æ›´æ–°â€œç”³è¯·æˆä¸ºå›¢é•¿/è¿›å…¥é—¨æˆ·â€æŒ‰é’®
        try {
          const cta = document.getElementById('leader-cta-btn');
          if (cta && window.navSystem && typeof window.navSystem.getUserRole === 'function') {
            const role = window.navSystem.getUserRole();
            if (role === 'leader') {
              cta.href = '/leader.html';
              cta.textContent = 'è¿›å…¥å›¢é•¿é—¨æˆ·';
              cta.className = 'btn btn-primary btn-sm';
            } else if (role === 'admin') {
              cta.href = '/admin.html';
              cta.textContent = 'è¿›å…¥ç®¡ç†åå°';
              cta.className = 'btn btn-primary btn-sm';
            } else {
              cta.href = '/profile.html';
              cta.textContent = 'ç”³è¯·æˆä¸ºå›¢é•¿';
              cta.className = 'btn btn-warning btn-sm';
            }
          }
        } catch (e) {}
      });
    </script>
</body>
</html>


